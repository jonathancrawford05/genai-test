{
  "experiment_summary": {
    "timestamp": "2026-01-27T13:23:44.042116",
    "total_variations": 270,
    "total_questions": 2,
    "total_runs": 540,
    "status": "Iteration 1 Complete"
  },
  "question_summaries": {
    "EF_1": {
      "question": "List all rating plan rules",
      "type": "Enumeration/List",
      "best_score": 0.7575757575757576,
      "worst_score": 0.0,
      "avg_score": 0.354433221099888
    },
    "EF_2": {
      "question": "Calculate hurricane premium for HO3, $750,000, 3000ft from coast (Expected: $604)",
      "type": "Calculation/Table Extraction",
      "best_score": 55.0,
      "worst_score": 15.0,
      "avg_score": 26.703703703703702,
      "scoring_method": "Component-based (5 components \u00d7 20 points = 100 total)"
    }
  },
  "top_10_EF1_configurations": [
    {
      "rank": 1,
      "score": 0.7575757575757576,
      "variation_name": "chunk_2000_topk_5_window0_docs1_page",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 1
      },
      "chunks_retrieved": 5
    },
    {
      "rank": 2,
      "score": 0.7575757575757576,
      "variation_name": "chunk_2000_topk_5_window0_docs5_page",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 5
      },
      "chunks_retrieved": 5
    },
    {
      "rank": 3,
      "score": 0.7575757575757576,
      "variation_name": "chunk_2000_topk_5_window0_docs1_document",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "document",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 1
      },
      "chunks_retrieved": 5
    },
    {
      "rank": 4,
      "score": 0.7575757575757576,
      "variation_name": "chunk_2000_topk_5_window0_docs5_document",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "document",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 5
      },
      "chunks_retrieved": 5
    },
    {
      "rank": 5,
      "score": 0.696969696969697,
      "variation_name": "chunk_1200_topk_5_window2_docs1_page",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 2,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 1
      },
      "chunks_retrieved": 20
    },
    {
      "rank": 6,
      "score": 0.696969696969697,
      "variation_name": "chunk_1200_topk_5_window2_docs5_page",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 2,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 5
      },
      "chunks_retrieved": 20
    },
    {
      "rank": 7,
      "score": 0.696969696969697,
      "variation_name": "chunk_1200_topk_5_window2_docs1_document",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 2,
        "chunking_strategy": "document",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 1
      },
      "chunks_retrieved": 20
    },
    {
      "rank": 8,
      "score": 0.696969696969697,
      "variation_name": "chunk_1200_topk_5_window2_docs5_document",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 2,
        "chunking_strategy": "document",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 5
      },
      "chunks_retrieved": 20
    },
    {
      "rank": 9,
      "score": 0.6666666666666666,
      "variation_name": "chunk_1200_topk_5_window1_docs1_page",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 1,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 1
      },
      "chunks_retrieved": 13
    },
    {
      "rank": 10,
      "score": 0.6666666666666666,
      "variation_name": "chunk_1200_topk_5_window1_docs5_page",
      "retriever_config": {
        "chunk_size": 1200,
        "top_k_per_step": 5,
        "expand_context": 1,
        "chunking_strategy": "page",
        "hybrid_alpha": 0.5
      },
      "router_config": {
        "top_k_docs": 5
      },
      "chunks_retrieved": 13
    }
  ],
  "top_10_EF2_configurations": [
    {
      "rank": 1,
      "total_score": 55.0,
      "variation_name": "chunk_400_topk_3_window0_docs5_document",
      "retriever_config": {
        "chunk_size": 400,
        "top_k_per_step": 3,
        "expand_context": 0,
        "chunking_strategy": "document"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 2,
      "total_score": 55.0,
      "variation_name": "chunk_2000_topk_1_window0_docs5_page",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 1,
        "expand_context": 0,
        "chunking_strategy": "page"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 3,
      "total_score": 55.0,
      "variation_name": "chunk_800_topk_1_window1_docs5_document",
      "retriever_config": {
        "chunk_size": 800,
        "top_k_per_step": 1,
        "expand_context": 1,
        "chunking_strategy": "document"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 4,
      "total_score": 55.0,
      "variation_name": "chunk_400_topk_5_window0_docs5_page",
      "retriever_config": {
        "chunk_size": 400,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "page"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 5,
      "total_score": 55.0,
      "variation_name": "chunk_400_topk_3_window0_docs5_page",
      "retriever_config": {
        "chunk_size": 400,
        "top_k_per_step": 3,
        "expand_context": 0,
        "chunking_strategy": "page"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 6,
      "total_score": 55.0,
      "variation_name": "chunk_2000_topk_1_window0_docs5_document",
      "retriever_config": {
        "chunk_size": 2000,
        "top_k_per_step": 1,
        "expand_context": 0,
        "chunking_strategy": "document"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 7,
      "total_score": 55.0,
      "variation_name": "chunk_800_topk_1_window1_docs5_page",
      "retriever_config": {
        "chunk_size": 800,
        "top_k_per_step": 1,
        "expand_context": 1,
        "chunking_strategy": "page"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 8,
      "total_score": 55.0,
      "variation_name": "chunk_800_topk_3_window0_docs5_page",
      "retriever_config": {
        "chunk_size": 800,
        "top_k_per_step": 3,
        "expand_context": 0,
        "chunking_strategy": "page"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 9,
      "total_score": 55.0,
      "variation_name": "chunk_400_topk_5_window0_docs5_document",
      "retriever_config": {
        "chunk_size": 400,
        "top_k_per_step": 5,
        "expand_context": 0,
        "chunking_strategy": "document"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    },
    {
      "rank": 10,
      "total_score": 55.0,
      "variation_name": "chunk_800_topk_3_window0_docs5_document",
      "retriever_config": {
        "chunk_size": 800,
        "top_k_per_step": 3,
        "expand_context": 0,
        "chunking_strategy": "document"
      },
      "router_config": {
        "top_k_docs": 5
      },
      "component_scores": {
        "document_retrieval": 20.0,
        "deductible_identification": 20.0,
        "base_rate_identification": 0.0,
        "factor_identification": 5.0,
        "calculation": 10.0
      }
    }
  ],
  "key_findings": {
    "EF_1_enumeration": {
      "best_configuration": {
        "chunk_size": 2000,
        "top_k_per_step": 5,
        "expand_context": 0,
        "hybrid_alpha": 0.5
      },
      "insight": "Larger chunk sizes (2000) perform best for enumeration tasks, capturing more list items per chunk. Window expansion (expand_context) provides diminishing returns for list tasks."
    },
    "EF_2_calculation": {
      "best_score": "55/100 (multiple configs tied)",
      "best_configuration": {
        "top_k_docs": 5,
        "insight": "Critical for retrieving both Rules Manual AND Rate Pages"
      },
      "component_performance": {
        "document_retrieval": "20/20 when top_k_docs=5",
        "deductible_identification": "20/20 when docs retrieved",
        "base_rate_identification": "0/20 - PRIMARY GAP",
        "factor_identification": "5/20 - SECONDARY GAP",
        "calculation": "10/20 - formula correct, values wrong"
      },
      "root_cause": "Retrieval queries not specific enough to extract $293 from Exhibit 1 and 2.061 from Exhibit 6",
      "proposed_fix": "Enhanced planner prompts with exhibit-specific query generation"
    }
  },
  "ef2_component_analysis": {
    "scoring_breakdown": {
      "document_retrieval": {
        "max_points": 20,
        "criteria": "10pts for Rules Manual + 10pts for Rate Pages",
        "success_rate": "33.3% full (20/20), 66.7% partial (10/20)"
      },
      "deductible_identification": {
        "max_points": 20,
        "criteria": "15pts for 2% deductible + 5pts for Rule C-7 reference",
        "success_rate": "4.4% full, 92.6% zero"
      },
      "base_rate_identification": {
        "max_points": 20,
        "criteria": "15pts for $293 value + 5pts for Exhibit 1 reference",
        "success_rate": "0% full, 4.4% partial, 95.6% zero"
      },
      "factor_identification": {
        "max_points": 20,
        "criteria": "15pts for 2.061 value + 5pts for Exhibit 6 reference",
        "success_rate": "0% full, 100% partial (criteria only)"
      },
      "calculation": {
        "max_points": 20,
        "criteria": "20pts for $604 answer OR 10pts for correct formula",
        "success_rate": "0% full, 71.1% partial (formula only)"
      }
    },
    "critical_findings": {
      "document_retrieval": "top_k_docs=5 achieves 100% retrieval of both documents; top_k_docs=1 or 3 fails",
      "main_bottleneck": "Base rate ($293) extraction from Exhibit 1 - 0% success across all configs",
      "secondary_bottleneck": "Factor (2.061) extraction from Exhibit 6 - 0% success, only criteria references found",
      "working_components": "Deductible ID works when docs retrieved (Rule C-7 + 2% found)",
      "formula_understanding": "71% show correct formula structure but lack actual values"
    },
    "recommendations_for_enhanced_prompts": [
      "Planner should generate specific queries for 'Exhibit 1 hurricane base rate $750,000'",
      "Planner should generate specific queries for 'Exhibit 6 deductible factor HO3 $750,000 2%'",
      "Orchestrator few-shot examples demonstrate exhibit citation format",
      "top_k_docs=5 is required for reliable document retrieval"
    ]
  },
  "validation_results": {
    "date": "2026-01-28",
    "description": "5-scenario validation with enhanced prompts",
    "scenarios": [
      {
        "id": "S1_EF2_best",
        "question": "EF_2",
        "enhanced_score": 50,
        "baseline_score": 55,
        "change": -5
      },
      {
        "id": "S2_EF2_large_chunk",
        "question": "EF_2",
        "enhanced_score": 55,
        "baseline_score": 55,
        "change": 0
      },
      {
        "id": "S3_EF2_medium",
        "question": "EF_2",
        "enhanced_score": 60,
        "baseline_score": 55,
        "change": 5
      },
      {
        "id": "S4_EF1_best",
        "question": "EF_1",
        "enhanced_score": 0,
        "baseline_score": 75.8,
        "change": -75.8
      },
      {
        "id": "S5_EF1_window",
        "question": "EF_1",
        "enhanced_score": 0,
        "baseline_score": 69.7,
        "change": -69.7
      }
    ],
    "summary": {
      "ef2_avg_change": 0.0,
      "ef1_avg_change": -72.8,
      "best_ef2_improvement": "+5 points with chunk=800, top_k=3, docs=5"
    },
    "conclusion": "Enhanced prompts showed marginal improvement for EF_2 but significant regression for EF_1. Calculation-specific prompts conflict with enumeration task requirements."
  },
  "lessons_learned": {
    "what_worked": [
      "Component-based scoring provided clear visibility into failure modes",
      "top_k_docs=5 is critical for multi-document questions",
      "Larger chunk sizes (2000) better for enumeration/list tasks",
      "Hybrid search (BM25 + semantic) with alpha=0.5 provided good balance"
    ],
    "what_didnt_work": [
      "One-size-fits-all prompts: Calculation-specific guidance hurt enumeration tasks",
      "Exhibit-specific queries did not significantly improve value extraction from tables"
    ],
    "root_cause": "Enhanced prompts added calculation-specific instructions that confused the model on simpler enumeration tasks without solving the fundamental table value extraction problem"
  },
  "next_steps": {
    "iteration_2_high_priority": [
      "Detect question type first (Enumeration vs Calculation vs Lookup)",
      "Apply type-specific prompts per question type",
      "Revert EF_1 prompts to baseline for enumeration tasks"
    ],
    "iteration_3_medium_priority": [
      "Table-aware PDF parsing - extract tables as structured data",
      "OCR enhancement for value extraction at ingestion",
      "Preserve table structure during chunking"
    ],
    "iteration_4_future": [
      "Confidence scoring to flag uncertain responses",
      "Caching layer to reduce latency",
      "API deployment for production integration"
    ]
  }
}